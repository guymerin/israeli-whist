<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    
    <!-- Safari specific meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Israeli Whist">
    
    <!-- Prevent text size adjustment on mobile Safari -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- Chrome/Android specific -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#0f0f23">
    
    <!-- Firefox specific optimizations -->
    <meta name="msapplication-tap-highlight" content="no">
    
    <title>Israeli Whist</title>
    
    <!-- Preload fonts for better cross-browser performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kalam:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Main stylesheet with fallbacks -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    
    <div class="game-container">
        <h1>Israeli Whist</h1>
        
        <!-- Fast Game Mode Toggle -->
        <div class="fast-mode-container">
            <label class="fast-mode-label">
                <input type="checkbox" id="fast-mode-checkbox" class="fast-mode-checkbox">
                <span class="fast-mode-text">⚡ Turbo</span>
            </label>
        </div>

        <!-- Game Control Buttons - positioned on the right side -->
        <div class="game-control-buttons">
            <button id="new-game-btn" class="new-game-btn">🔄 New Game</button>
            <button id="rules-btn" class="rules-btn">📖 Rules</button>
            <button id="hint-btn" class="hint-btn">💡 Hint</button>

        </div>
        
        <!-- Game Status -->
        <div class="game-status">
            <div class="tricks-counter">Round: <span id="tricks-indicator">0</span></div>
            <div class="bid-trump-container">
                <div class="trump-suit"><span id="trump-indicator">-</span></div>
                <div class="current-turn">Bid: <span id="turn-indicator">-</span></div>
            </div>
            <div class="round-counter">Gamlet: <span id="round-indicator">1</span></div>
            <div class="total-bids" id="total-bids" style="display: none;">Total Bids: <span id="total-bids-value">0</span></div>
        </div>



        <!-- Total Score Box -->
        <div class="total-score-box">
            <div class="total-score-header">
                <div class="total-score-title" id="score-view-title">Total Score</div>
                <button class="extended-view-btn" id="extended-view-btn" title="Show extended scorecard">+</button>
            </div>
            <div class="total-score-content" id="total-score-content">
                <!-- Score items will be dynamically generated and sorted by JavaScript -->
            </div>
            <div class="extended-score-content" id="extended-score-content" style="display: none;">
                <!-- Extended scorecard table will be generated here -->
            </div>
        </div>

        <!-- Game Board -->
        <div class="game-board">
            <!-- North Player (Bot) -->
            <div class="player north-player" id="north-player">
                <div class="player-info">
                    <span class="player-name">Botti (N)</span>
                    <span class="player-bid">Bid: <span id="north-bid">-</span></span>
                    <span class="player-tricks">Takes: <span id="north-takes">0</span></span>
                </div>
                <div class="player-cards bot-cards" id="north-cards"></div>
                <div class="trick-counter" id="north-tricks"></div>
                <!-- Persistent notification area -->
                <div id="north-notification" class="north-notification" style="display: none;"></div>
            </div>

            <!-- West Player (Bot) -->
            <div class="player west-player" id="west-player">
                <div class="player-info">
                    <span class="player-name">Chati (W)</span>
                    <span class="player-bid">Bid: <span id="west-bid">-</span></span>
                    <span class="player-tricks">Takes: <span id="west-takes">0</span></span>
                </div>
                <div class="player-cards bot-cards" id="west-cards"></div>
                <div class="trick-counter" id="west-tricks"></div>
            </div>

            <!-- Center Area (Tricks) -->
            <div class="center-area">
                <div class="trick-area" id="trick-area">
                    <div class="played-card north-played" id="north-played"></div>
                    <div class="played-card west-played" id="west-played"></div>
                    <div class="played-card south-played" id="south-played"></div>
                    <div class="played-card east-played" id="east-played"></div>
                    <div class="game-controls">
                        <button id="deal-btn" class="action-btn">Deal Cards</button>
                        <button id="force-bid-btn" class="action-btn" style="background: orange; color: white; font-weight: bold; display: none;" onclick="if(window.forceBidding) window.forceBidding();">Show Bidding</button>
                    </div>
                </div>
                
                <!-- Won Tricks Display -->
                <div class="won-tricks-display" id="won-tricks-display">
                    <div class="won-tricks north-won" id="north-won"></div>
                    <div class="won-tricks west-won" id="west-won"></div>
                    <div class="won-tricks south-won" id="south-won"></div>
                    <div class="won-tricks east-won" id="east-won"></div>
                </div>
            </div>

            <!-- East Player (Bot) -->
            <div class="player east-player" id="east-player">
                <div class="player-info">
                    <span class="player-name">Droidi (E)</span>
                    <span class="player-bid">Bid: <span id="east-bid">-</span></span>
                    <span class="player-tricks">Takes: <span id="east-takes">0</span></span>
                </div>
                <div class="player-cards bot-cards" id="east-cards"></div>
                <div class="trick-counter" id="east-tricks"></div>
            </div>

            <!-- South Player (Human) -->
            <div class="player south-player" id="south-player">
                <div class="player-info">
                    <span class="player-name" id="south-player-name">South (You)</span>
                    <span class="player-bid">Bid: <span id="south-bid">-</span></span>
                    <span class="player-tricks">Takes: <span id="south-takes">0</span></span>
                </div>
                <div class="player-cards human-cards" id="south-cards"></div>
                <div class="trick-counter" id="south-tricks"></div>
            </div>
        </div>

        <!-- Bidding Interface -->
        <div class="bidding-interface" id="bidding-interface" style="display: none;">
            <h3>Phase: Trump selection</h3>

            <div class="bid-controls">
                <div class="input-row">
                    <div class="tricks-selector">
                        <div class="tricks-buttons" id="tricks-buttons">
                            <!-- Buttons will be populated by JavaScript -->
                        </div>
                    </div>
                    <div class="suit-selector">

                        <div class="suit-buttons" id="suit-buttons">
                            <!-- Buttons will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div class="button-row">
                    <button id="bid-btn" class="action-btn">Bid</button>
                    <button id="pass-btn" class="action-btn">Pass</button>

                </div>
            </div>
        </div>



        <!-- Second Phase Bidding -->
        <div class="second-phase-bidding" id="second-phase-bidding" style="display: none;">
            <div class="phase2-header">
                <h3>Trick Takes Phase</h3>
                <div class="trump-reminder">
                    Trump: <span id="trump-reminder"></span>
                </div>
            </div>
            
            <div class="predictions-status">
                <h4>Players' Takes (Predicted Tricks):</h4>
                <div class="prediction-list">
                    <div class="prediction-item">
                        <span class="player-name">B:</span>
                        <span id="north-prediction" class="prediction-value">-</span>
                    </div>
                    <div class="prediction-item">
                        <span class="player-name">D:</span>
                        <span id="east-prediction" class="prediction-value">-</span>
                    </div>
                    <div class="prediction-item">
                        <span class="player-name" id="south-prediction-label">S:</span>
                        <span id="south-prediction" class="prediction-value">-</span>
                    </div>
                    <div class="prediction-item">
                        <span class="player-name">C:</span>
                        <span id="west-prediction" class="prediction-value">-</span>
                    </div>
                </div>
                <div class="prediction-total" style="display: none;">
                    <span id="prediction-total">0</span> 
                    <span id="prediction-status"></span>
                </div>
            </div>
            
            <div class="your-prediction" id="your-prediction-controls" style="display: none;">
                <h4>How many tricks will you take?</h4>
                <div class="tricks-prediction" id="tricks-prediction">
                    <div class="tricks-buttons-main" id="tricks-buttons-main">
                        <button class="trick-btn" data-value="0">0</button>
                        <button class="trick-btn" data-value="1">1</button>
                        <button class="trick-btn" data-value="2">2</button>
                        <button class="trick-btn" data-value="3">3</button>
                        <button class="trick-btn" data-value="4">4</button>
                        <button class="trick-btn" data-value="5">5</button>
                        <button class="trick-btn" data-value="6">6</button>
                        <button class="trick-btn" data-value="7">7</button>
                    </div>
                    <div class="tricks-buttons-extra" id="tricks-buttons-extra" style="display: none;">
                        <!-- Row 1: 0-3 -->
                        <div class="tricks-row">
                            <button class="trick-btn" data-value="0">0</button>
                            <button class="trick-btn" data-value="1">1</button>
                            <button class="trick-btn" data-value="2">2</button>
                            <button class="trick-btn" data-value="3">3</button>
                        </div>
                        <!-- Row 2: 4-7 -->
                        <div class="tricks-row">
                            <button class="trick-btn" data-value="4">4</button>
                            <button class="trick-btn" data-value="5">5</button>
                            <button class="trick-btn" data-value="6">6</button>
                            <button class="trick-btn" data-value="7">7</button>
                        </div>
                        <!-- Row 3: 8-11 -->
                        <div class="tricks-row">
                            <button class="trick-btn" data-value="8">8</button>
                            <button class="trick-btn" data-value="9">9</button>
                            <button class="trick-btn" data-value="10">10</button>
                            <button class="trick-btn" data-value="11">11</button>
                        </div>
                        <!-- Row 4: 12-13 (centered) -->
                        <div class="tricks-row tricks-row-final">
                            <button class="trick-btn" data-value="12">12</button>
                            <button class="trick-btn" data-value="13">13</button>
                        </div>
                    </div>
                    <button class="more-btn" id="more-tricks-btn">More</button>
                    <button class="less-btn" id="less-tricks-btn" style="display: none;">Less</button>
                </div>
            </div>
            
            <div class="waiting-message" id="waiting-message" style="display: none;">
                <p>Waiting for other players to make their predictions...</p>
            </div>
        </div>
        
        <!-- Player Name Modal -->
        <div class="name-modal" id="name-modal" style="display: block;">
            <div class="name-content">
                <div class="name-header">
                    <h2>🎮 Welcome to Israeli Whist!</h2>
                </div>
                <div class="name-body">
                    <p>Please enter your name to begin:</p>
                    <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="20" autocomplete="name">
                    <button id="start-game-btn" class="action-btn">Start Game</button>
                </div>
            </div>
        </div>

        <!-- Rules Modal -->
        <div class="rules-modal" id="rules-modal" style="display: none;">
            <div class="rules-content">
                <div class="rules-header">
                    <h2>📖 Israeli Whist Rules</h2>
                    <button id="close-rules-btn" class="close-btn">×</button>
                </div>
                <div class="rules-body">
                    <div class="rules-section">
                        <h3>🎯 Game Overview</h3>
                        <p>Israeli Whist is a trick-taking card game for 4 players. The goal is to win exactly the number of tricks you bid for.</p>
                    </div>
                    
                    <div class="rules-section">
                        <h3>🃏 Phase 1: Trump Bidding</h3>
                        <ul>
                            <li>Players bid on trump suit and minimum number of tricks (4-13)</li>
                            <li>Each bid must be higher than the previous (more tricks OR same tricks with higher trump)</li>
                            <li>Trump ranking: Clubs (♣) < Diamonds (♦) < Hearts (♥) < Spades (♠) < No Trump</li>
                            <li>Trump winner leads the first trick</li>
                        </ul>
                    </div>
                    
                    <div class="rules-section">
                        <h3>🎲 Phase 2: Takes Bidding</h3>
                        <ul>
                            <li>All players bid on how many tricks they will take</li>
                            <li>Trump winner must bid at least their Phase 1 minimum</li>
                            <li><strong>Total bids cannot equal exactly 13</strong></li>
                            <li>Bidding order: Trump winner, then clockwise</li>
                        </ul>
                    </div>
                    
                    <div class="rules-section">
                        <h3>🃏 Phase 3: Playing</h3>
                        <ul>
                            <li>Trump winner leads first trick, then clockwise</li>
                            <li>Must follow suit if possible</li>
                            <li>Trump can be played anytime</li>
                            <li>Highest card of led suit wins, unless trumped</li>
                            <li>Winner of each trick leads the next</li>
                        </ul>
                    </div>
                    
                    <div class="rules-section">
                        <h3>🏆 Scoring</h3>
                        <ul>
                            <li>Score 10 points for each trick taken</li>
                            <li>Bonus 10 points if you take exactly your bid</li>
                            <li>Penalty: Lose 10 points for each trick over/under your bid</li>
                        </ul>
                    </div>
                    
                    <div class="rules-section">
                        <h3>💡 Strategy Tips</h3>
                        <ul>
                            <li>Trump bidding: Consider hand strength and distribution</li>
                            <li>Takes bidding: Be realistic about your hand's potential</li>
                            <li>Playing: Adapt strategy based on whether you need more tricks or have enough</li>
                            <li>Sometimes it's better to lose a trick than win an unwanted one</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hint Modal -->
    <div id="hint-modal" class="hint-modal" style="display: none;">
        <div class="hint-content">
            <div class="hint-header">
                <h3>💡 Strategic Hint</h3>
                <button class="hint-close" id="hint-close">&times;</button>
            </div>
            <div class="hint-body" id="hint-body">
                <!-- Hint content will be populated by JavaScript -->
            </div>
            <div class="hint-footer">
                <button class="hint-btn-close" id="hint-btn-close">Got it!</button>
            </div>
        </div>
    </div>



    <!-- Polyfills for older browser support -->
    <script>
        // Array.includes polyfill for IE
        if (!Array.prototype.includes) {
            Array.prototype.includes = function(searchElement /*, fromIndex*/) {
                'use strict';
                var O = Object(this);
                var len = parseInt(O.length) || 0;
                if (len === 0) return false;
                var n = parseInt(arguments[1]) || 0;
                var k;
                if (n >= 0) {
                    k = n;
                } else {
                    k = len + n;
                    if (k < 0) k = 0;
                }
                var currentElement;
                while (k < len) {
                    currentElement = O[k];
                    if (searchElement === currentElement ||
                       (searchElement !== searchElement && currentElement !== currentElement)) {
                        return true;
                    }
                    k++;
                }
                return false;
            };
        }

        // Object.values polyfill for older browsers
        if (!Object.values) {
            Object.values = function(obj) {
                var vals = [];
                for (var key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        vals.push(obj[key]);
                    }
                }
                return vals;
            };
        }

        // Array.from polyfill for older browsers
        if (!Array.from) {
            Array.from = function(arrayLike) {
                var result = [];
                for (var i = 0; i < arrayLike.length; i++) {
                    result.push(arrayLike[i]);
                }
                return result;
            };
        }

        // querySelector polyfill for very old browsers
        if (!document.querySelector) {
            document.querySelector = function(selector) {
                return document.querySelectorAll(selector)[0] || null;
            };
        }

        // classList polyfill for older browsers
        if (!("classList" in document.documentElement)) {
            Object.defineProperty(HTMLElement.prototype, 'classList', {
                get: function() {
                    var self = this;
                    function update(fn) {
                        return function(value) {
                            var classes = self.className.split(/\s+/);
                            var index = classes.indexOf(value);
                            fn(classes, index, value);
                            self.className = classes.join(" ");
                        };
                    }
                    var ret = {
                        add: update(function(classes, index, value) {
                            if (!~index) classes.push(value);
                        }),
                        remove: update(function(classes, index) {
                            if (~index) classes.splice(index, 1);
                        }),
                        toggle: update(function(classes, index, value) {
                            if (~index) {
                                classes.splice(index, 1);
                            } else {
                                classes.push(value);
                            }
                        }),
                        contains: function(value) {
                            return !!~self.className.split(/\s+/).indexOf(value);
                        }
                    };
                    return ret;
                }
            });
        }
    </script>

    <script src="script.js"></script>
</body>
</html>
